-- Check if UI already exists and remove it
for _, v in pairs(game.CoreGui:GetChildren()) do
    if v.Name == "UiLib" then
        v:Destroy()
    end
end

local UiLib = Instance.new("ScreenGui")
UiLib.Name = "UiLib"
UiLib.Parent = game.CoreGui
UiLib.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- Function to calculate next window position
local function getNextWindowPos()
    local biggest = 0
    local ok = nil
    for _, v in pairs(UiLib:GetChildren()) do
        if v:IsA("Frame") and v.Position.X.Offset > biggest then
            biggest = v.Position.X.Offset
            ok = v
        end
    end
    return biggest == 0 and 15 or biggest + ok.Size.X.Offset + 10
end

local Library = {}

-- Window creation function
function Library:Window(title)
    local Top = Instance.new("Frame")
    local UICorner = Instance.new("UICorner")
    local Container = Instance.new("Frame")
    local UIListLayout = Instance.new("UIListLayout")
    local Line = Instance.new("Frame")
    local Title = Instance.new("TextLabel")
    local Minimize = Instance.new("ImageButton")

    -- Initialize Top Frame
    Top.Name = "Top"
    Top.Parent = UiLib
    Top.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    Top.Position = UDim2.new(0, getNextWindowPos(), 0.01, 0)
    Top.Size = UDim2.new(0, 204, 0, 28)
    Top.Active = true
    Top.Draggable = true
    UICorner.CornerRadius = UDim.new(0, 4)
    UICorner.Parent = Top

    -- Initialize Container Frame
    Container.Name = "Container"
    Container.Parent = Top
    Container.BackgroundTransparency = 1
    Container.ClipsDescendants = true
    Container.Position = UDim2.new(0, 0, 1, 0)
    Container.Size = UDim2.new(0, 204, 0, 762)

    -- Layout for buttons and other components
    UIListLayout.Parent = Container
    UIListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
    UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder

    -- Initialize Bottom Line
    Line.Name = "Line"
    Line.Parent = Top
    Line.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    Line.Position = UDim2.new(0, 0, 0.892857134, 0)
    Line.Size = UDim2.new(0, 204, 0, 3)

    -- Initialize Title
    Title.Name = "Title"
    Title.Parent = Top
    Title.BackgroundTransparency = 1
    Title.Position = UDim2.new(0.0245098043, 0, 0.142857149, 0)
    Title.Size = UDim2.new(0, 174, 0, 20)
    Title.Font = Enum.Font.GothamSemibold
    Title.Text = title
    Title.TextColor3 = Color3.fromRGB(255, 255, 255)
    Title.TextScaled = true

    -- Minimize Button
    Minimize.Name = "Minimize"
    Minimize.Parent = Top
    Minimize.BackgroundTransparency = 1
    Minimize.Position = UDim2.new(0.877, 0, 0, 0)
    Minimize.Rotation = 90
    Minimize.Size = UDim2.new(0, 25, 0, 25)
    Minimize.Image = "rbxassetid://3926307971"
    Minimize.ImageColor3 = Color3.fromRGB(0, 255, 102)
    Minimize.ImageRectOffset = Vector2.new(764, 244)
    Minimize.ImageRectSize = Vector2.new(36, 36)

    -- Toggle minimize/maximize functionality
    Minimize.MouseButton1Click:Connect(function()
        local container = Minimize.Parent.Container
        local line = Minimize.Parent.Line
        local isMaximized = container.Size.Y.Offset == 762

        -- Animate the minimize/maximize
        game:GetService("TweenService"):Create(Minimize, TweenInfo.new(0.25), {Rotation = isMaximized and 180 or 90}):Play()
        game:GetService("TweenService"):Create(Minimize, TweenInfo.new(0.25), {ImageColor3 = isMaximized and Color3.fromRGB(255, 0, 68) or Color3.fromRGB(0, 255, 102)}):Play()
        container:TweenSize(UDim2.new(0, 204, 0, isMaximized and 0 or 762), "InOut", "Sine", 0.25, true)
        line.Visible = not isMaximized
    end)

    -- Define UI elements for the window
    local Lib = {}

    -- Button creation
    function Lib:Button(name, callback)
        local ButtonContainer = Instance.new("Frame")
        local Button = Instance.new("TextButton")
        local ButtonAni = Instance.new("Frame")
        local UICorner_2 = Instance.new("UICorner")
        local ButtonName = Instance.new("TextLabel")

        ButtonContainer.Name = "ButtonContainer"
        ButtonContainer.Parent = Container
        ButtonContainer.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
        ButtonContainer.Size = UDim2.new(0, 204, 0, 28)

        Button.Name = "Button"
        Button.Parent = ButtonContainer
        Button.BackgroundTransparency = 1
        Button.Size = UDim2.new(0, 204, 0, 28)
        Button.Text = ""
        Button.MouseButton1Click:Connect(callback)

        ButtonAni.Name = "ButtonAni"
        ButtonAni.Parent = Button
        ButtonAni.BackgroundColor3 = Color3.fromRGB(0, 255, 102)
        ButtonAni.Position = UDim2.new(0.0245, 0, 0.071, 0)
        UICorner_2.CornerRadius = UDim.new(0, 4)
        UICorner_2.Parent = ButtonAni

        ButtonName.Name = "ButtonName"
        ButtonName.Parent = ButtonContainer
        ButtonName.BackgroundTransparency = 1
        ButtonName.Position = UDim2.new(0.0245, 0, 0.1429, 0)
        ButtonName.Size = UDim2.new(0, 194, 0, 20)
        ButtonName.Font = Enum.Font.GothamSemibold
        ButtonName.Text = name
        ButtonName.TextColor3 = Color3.fromRGB(255, 255, 255)
        ButtonName.TextScaled = true

        -- Animate button click effect
        Button.MouseButton1Click:Connect(function()
            ButtonAni:TweenSize(UDim2.new(0, 194, 0, 24), "InOut", "Sine", 0.3, true)
            wait(0.45)
            ButtonAni:TweenSize(UDim2.new(0, 0, 0, 0), "InOut", "Sine", 0.3, true)
        end)
    end

    -- Toggle creation
    function Lib:Toggle(name, callback)
        local ToggleContainer = Instance.new("Frame")
        local ToggleName = Instance.new("TextLabel")
        local Toggle = Instance.new("TextButton")
        local UICorner_3 = Instance.new("UICorner")
        local Off = Instance.new("ImageLabel")
        local On = Instance.new("ImageLabel")

        ToggleContainer.Name = "ToggleContainer"
        ToggleContainer.Parent = Container
        ToggleContainer.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
        ToggleContainer.Size = UDim2.new(0, 204, 0, 30)

        ToggleName.Name = "ToggleName"
        ToggleName.Parent = ToggleContainer
        ToggleName.BackgroundTransparency = 1
        ToggleName.Position = UDim2.new(0.0245, 0, 0.1429, 0)
        ToggleName.Size = UDim2.new(0, 169, 0, 20)
        ToggleName.Font = Enum.Font.GothamSemibold
        ToggleName.Text = name
        ToggleName.TextColor3 = Color3.fromRGB(255, 255, 255)
        ToggleName.TextScaled = true

        Toggle.Name = "Toggle"
        Toggle.Parent = ToggleContainer
        Toggle.BackgroundColor3 = Color3.fromRGB(39, 39, 39)
        Toggle.Size = UDim2.new(0, 25, 0, 23)
        Toggle.AutoButtonColor = false
        Toggle.Text = ""
        local Toggled = false
        Toggle.MouseButton1Click:Connect(function()
            Toggled = not Toggled
            callback(Toggled)
        end)

        UICorner_3.CornerRadius = UDim.new(0, 3)
        UICorner_3.Parent = Toggle

        -- Toggle images for on/off states
        Off.Name = "Off"
        Off.Parent = Toggle
        Off.BackgroundTransparency = 1
        Off.Size = UDim2.new(0, 25, 0, 25)
        Off.Image = "rbxassetid://3926305904"
        Off.ImageColor3 = Color3.fromRGB(255, 0, 68)

        On.Name = "On"
        On.Parent = Toggle
        On.BackgroundTransparency = 1
        On.Size = UDim2.new(0, 25, 0, 25)
        On.Visible = false
        On.Image = "rbxassetid://3926305904"
        On.ImageColor3 = Color3.fromRGB(0, 255, 102)

        -- Animate toggle button change
        Toggle.MouseButton1Click:Connect(function()
            if Toggled then
                Off.Visible = false
                On.Visible = true
            else
                On.Visible = false
                Off.Visible = true
            end
        end)
    end

    return Lib
end

return Library
